<!DOCTYPE html><html><head><title>model.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../../../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../../../index.html" class="source"><span class="file_name">README</span></a><a href="../../../Gruntfile.coffee.html" class="source "><span class="base_path">. / </span><span class="file_name">Gruntfile.coffee</span></a><a href="../../../app/views/session/login-page-view.coffee.html" class="source "><span class="base_path">app / views / session / </span><span class="file_name">login-page-view.coffee</span></a><a href="../../../app/views/home/business-page-view.coffee.html" class="source "><span class="base_path">app / views / home / </span><span class="file_name">business-page-view.coffee</span></a><a href="../../../app/views/home/offers-page-view.coffee.html" class="source "><span class="base_path">app / views / home / </span><span class="file_name">offers-page-view.coffee</span></a><a href="../../../app/views/layout/site-view.coffee.html" class="source "><span class="base_path">app / views / layout / </span><span class="file_name">site-view.coffee</span></a><a href="../../../app/views/layout/header-view.coffee.html" class="source "><span class="base_path">app / views / layout / </span><span class="file_name">header-view.coffee</span></a><a href="../../../app/views/layout/footer-view.coffee.html" class="source "><span class="base_path">app / views / layout / </span><span class="file_name">footer-view.coffee</span></a><a href="../../../app/views/base/view.coffee.html" class="source "><span class="base_path">app / views / base / </span><span class="file_name">view.coffee</span></a><a href="../../../app/views/base/collection-view.coffee.html" class="source "><span class="base_path">app / views / base / </span><span class="file_name">collection-view.coffee</span></a><a href="../../../app/models/town.coffee.html" class="source "><span class="base_path">app / models / </span><span class="file_name">town.coffee</span></a><a href="../../../app/models/offer.coffee.html" class="source "><span class="base_path">app / models / </span><span class="file_name">offer.coffee</span></a><a href="../../../app/models/country.coffee.html" class="source "><span class="base_path">app / models / </span><span class="file_name">country.coffee</span></a><a href="../../../app/models/state.coffee.html" class="source "><span class="base_path">app / models / </span><span class="file_name">state.coffee</span></a><a href="../../../app/models/business.coffee.html" class="source "><span class="base_path">app / models / </span><span class="file_name">business.coffee</span></a><a href="../../../app/models/base/collection.coffee.html" class="source "><span class="base_path">app / models / base / </span><span class="file_name">collection.coffee</span></a><a href="../../../app/models/base/model.coffee.html" class="source selected"><span class="base_path">app / models / base / </span><span class="file_name">model.coffee</span></a><a href="../../../app/models/base/pageable-collection.coffee.html" class="source "><span class="base_path">app / models / base / </span><span class="file_name">pageable-collection.coffee</span></a><a href="../../../app/routes.coffee.html" class="source "><span class="base_path">app / </span><span class="file_name">routes.coffee</span></a><a href="../../../app/lib/view-helper.coffee.html" class="source "><span class="base_path">app / lib / </span><span class="file_name">view-helper.coffee</span></a><a href="../../../app/lib/utils.coffee.html" class="source "><span class="base_path">app / lib / </span><span class="file_name">utils.coffee</span></a><a href="../../../app/lib/live-edit/live-edit.coffee.html" class="source "><span class="base_path">app / lib / live-edit / </span><span class="file_name">live-edit.coffee</span></a><a href="../../../app/config.coffee.html" class="source "><span class="base_path">app / </span><span class="file_name">config.coffee</span></a><a href="../../../app/initialize.coffee.html" class="source "><span class="base_path">app / </span><span class="file_name">initialize.coffee</span></a><a href="../../../app/application.coffee.html" class="source "><span class="base_path">app / </span><span class="file_name">application.coffee</span></a><a href="../../../app/controllers/session-controller.coffee.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">session-controller.coffee</span></a><a href="../../../app/controllers/base/controller.coffee.html" class="source "><span class="base_path">app / controllers / base / </span><span class="file_name">controller.coffee</span></a><a href="../../../app/controllers/home-controller.coffee.html" class="source "><span class="base_path">app / controllers / </span><span class="file_name">home-controller.coffee</span></a><a href="../../../config.coffee.html" class="source "><span class="base_path">. / </span><span class="file_name">config.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>model.coffee</h1><div class="filepath">app/models/base/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div>
</td><td class="code"><div class="highlight"><pre><span class="s">&#39;use strict&#39;</span>

<span class="nv">utils = </span><span class="nx">require</span> <span class="s">&#39;lib/utils&#39;</span>
<span class="nv">EventBroker = </span><span class="nx">Chaplin</span><span class="p">.</span><span class="nx">EventBroker</span></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>Private helper function for serializing attributes recursively,
creating objects which delegate to the original attributes
in order to protect them from changes.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">serializeAttributes = </span><span class="nf">(model, attributes, modelStack) -&gt;</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>Create a delegator object.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">delegator = </span><span class="nx">utils</span><span class="p">.</span><span class="nx">beget</span> <span class="nx">attributes</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><p>Add model to stack.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">modelStack</span> <span class="o">?=</span> <span class="p">{}</span>
  <span class="nx">modelStack</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span> <span class="o">=</span> <span class="kc">true</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><p>Map model/collection to their attributes. Create a property
on the delegator that shadows the original attribute.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">attributes</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><p>Handle models.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">if</span> <span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span>
      <span class="nx">delegator</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">serializeModelAttributes</span> <span class="nx">value</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">modelStack</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><p>Handle collections.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="k">else</span> <span class="k">if</span> <span class="nx">value</span> <span class="k">instanceof</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span>
      <span class="nv">serializedModels = </span><span class="p">[]</span>
      <span class="k">for</span> <span class="nx">otherModel</span> <span class="k">in</span> <span class="nx">value</span><span class="p">.</span><span class="nx">models</span>
        <span class="nx">serializedModels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
          <span class="nx">serializeModelAttributes</span><span class="p">(</span><span class="nx">otherModel</span><span class="p">,</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">modelStack</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="nx">delegator</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="nx">serializedModels</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><p>Remove model from stack.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">delete</span> <span class="nx">modelStack</span><span class="p">[</span><span class="nx">model</span><span class="p">.</span><span class="nx">cid</span><span class="p">]</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><p>Return the delegator.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">delegator</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><p>Serialize the attributes of a given model
in the context of a given tree.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">serializeModelAttributes = </span><span class="nf">(model, currentModel, modelStack) -&gt;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>Nullify circular references.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="k">return</span> <span class="kc">null</span> <span class="k">if</span> <span class="nx">model</span> <span class="o">is</span> <span class="nx">currentModel</span> <span class="o">or</span> <span class="nx">model</span><span class="p">.</span><span class="nx">cid</span> <span class="k">of</span> <span class="nx">modelStack</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>Serialize recursively.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">attributes = </span><span class="k">if</span> <span class="k">typeof</span> <span class="nx">model</span><span class="p">.</span><span class="nx">getAttributes</span> <span class="o">is</span> <span class="s">&#39;function&#39;</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><p>Chaplin models.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">model</span><span class="p">.</span><span class="nx">getAttributes</span><span class="p">()</span>
  <span class="k">else</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><p>Backbone models.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">model</span><span class="p">.</span><span class="nx">attributes</span>
  <span class="nx">serializeAttributes</span> <span class="nx">model</span><span class="p">,</span> <span class="nx">attributes</span><span class="p">,</span> <span class="nx">modelStack</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><p>Abstraction that adds some useful functionality to backbone model.</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">module.exports = </span><span class="k">class</span> <span class="nx">Model</span> <span class="k">extends</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">RelationalModel</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>Mixin an EventBroker.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span> <span class="nx">@prototype</span><span class="p">,</span> <span class="nx">EventBroker</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>This method is used to get the attributes for the view template
and might be overwritten by decorators which cannot create a
proper <code>attributes</code> getter due to ECMAScript 3 limits.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">getAttributes: </span><span class="nf">-&gt;</span>
    <span class="nx">@attributes</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Return an object which delegates to the attributes
(i.e. an object which has the attributes as prototype)
so primitive values might be added and altered safely.
Map models to their attributes, recursively.</p>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">serialize: </span><span class="nf">-&gt;</span>
    <span class="nx">serializeAttributes</span> <span class="k">this</span><span class="p">,</span> <span class="nx">@getAttributes</span><span class="p">()</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><h2>Disposal</h2>
</td><td class="code"><div class="highlight"><pre>  <span class="nv">disposed: </span><span class="kc">false</span>

  <span class="nv">dispose: </span><span class="nf">-&gt;</span>
    <span class="k">return</span> <span class="k">if</span> <span class="nx">@disposed</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>Fire an event to notify associated collections and views.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@trigger</span> <span class="s">&#39;dispose&#39;</span><span class="p">,</span> <span class="k">this</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>Unbind all global event handlers.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@unsubscribeAllEvents</span><span class="p">()</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>Unbind all referenced handlers.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@stopListening</span><span class="p">()</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>Remove all event handlers on this module.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nx">@</span><span class="kc">off</span><span class="p">()</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>Remove the collection reference, internal attribute hashes
and event handlers.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">properties = </span><span class="p">[</span>
      <span class="s">&#39;collection&#39;</span><span class="p">,</span>
      <span class="s">&#39;attributes&#39;</span><span class="p">,</span> <span class="s">&#39;changed&#39;</span>
      <span class="s">&#39;_escapedAttributes&#39;</span><span class="p">,</span> <span class="s">&#39;_previousAttributes&#39;</span><span class="p">,</span>
      <span class="s">&#39;_silent&#39;</span><span class="p">,</span> <span class="s">&#39;_pending&#39;</span><span class="p">,</span>
      <span class="s">&#39;_callbacks&#39;</span>
    <span class="p">]</span>
    <span class="k">delete</span> <span class="k">this</span><span class="p">[</span><span class="nx">prop</span><span class="p">]</span> <span class="k">for</span> <span class="nx">prop</span> <span class="k">in</span> <span class="nx">properties</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>Finished.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="vi">@disposed = </span><span class="kc">true</span></pre></div></td></tr><tr id="section-26"><td class="docs"><div class="pilwrap"><a href="#section-26" class="pilcrow">&#182;</a></div><p>You’re frozen when your heart’s not open.</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nb">Object</span><span class="p">.</span><span class="nx">freeze</span><span class="o">?</span> <span class="k">this</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Tue Nov 19 2013 18:37:02 GMT+0000 (WET)  </div><div id="projectname"><a href="../../../index.html">Foodicious staff</a></div></div></body></html>